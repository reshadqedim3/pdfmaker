<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF/Şəkil → Tək PDF (Birləşdir)</title>
  <style>
    :root{--bg:#ff172a;--card:#111827;--muted:#f34155;--text:#e5e7eb;--accent:#22c55e;--danger:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(135deg,#bbbbbb,#0b1220);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:400px;margin:40px auto;padding:20px}
    .title{font-size:8px;font-weight:700;letter-spacing:.3px;margin-bottom:16px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:16px}
    label{display:block;margin-bottom:8px;color:#cbd5e1}
    input[type="file"]{display:block;width:100%;padding:10px;background:#0b1220;border:1px dashed #334155;border-radius:10px;color:#cbd5e1}
    .row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  width: 300px;
}
    .col{flex:1;min-width:320px}
    .list{margin-top:12px;border:1px solid #cccccc;border-radius:12px;min-height:180px;background:#0b1220;padding:6px}
    .item{display:flex;align-items:center;gap:10px;background:#0f172a;border:1px solid #1f2937;border-radius:10px;padding:8px 10px;margin:6px 0;cursor:grab}
    .item.dragging{opacity:.6}
    .badge{font-size:12px;padding:2px 6px;border-radius:999px;background:#0b1220;border:1px solid #334155;color:#cbd5e1}
    .name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .size{font-variant-numeric:tabular-nums;color:#94a3b8}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .btn{border:1px solid #1f2937;background:#bbbbbb;color:#e5e7eb;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:#16a34a;color:#052e11;font-weight:700}
    .btn.danger{background:var(--danger);border-color:#b91c1c;color:#2b0a0a;font-weight:700}
    .hint{font-size:12px;color:#94a3b8;margin-top:6px}
    .footer{margin-top:18px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .footer input[type="text"]{flex:1;min-width:220px;padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:#e5e7eb}
    .sep{height:1px;background:#1f2937;margin:18px 0}
  </style>
  <!-- pdf-lib -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body>
  <div class="wrap">
    

    <section class="card">
      <div class="row">
        <div class="col">
          <label>Faylları seç (PDF, PNG, JPG)</label>
          <input type="file" id="mix-input" accept="application/pdf,image/png,image/jpeg" multiple />
          <div class="hint">Sıralamanı aşağıdakı siyahıda sürüklə-buraxla qur.</div>
          <label>Sıra (PDF və Şəkillər birlikdə)</label>
          <div id="mix-list" class="list" aria-label="Fayl siyahısı"></div>
          <div class="controls">
            <button class="btn" id="mix-up">Yuxarı</button>
            <button class="btn" id="mix-down">Aşağı</button>
            <button class="btn danger" id="mix-remove">Sil</button>
            <button class="btn" id="mix-clear">Təmizlə</button>
				
				  </div>
        
        </div>
      </div>
      <div class="sep"></div>
      <div class="footer">
        <input type="text" id="mix-output-name" placeholder="Yekun fayl adı (məs.: yekun.pdf)" />
        <button class="btn primary" id="btn-build">Yarat və Yüklə</button>
      </div>
    </section>
  </div>

<script>
(function(){
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => Array.from(document.querySelectorAll(s));

  // Utility: download
  function downloadBytes(bytes, name){
    const blob = new Blob([bytes], {type:'application/pdf'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=ensurePdfExt(name||'output.pdf');
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }
  function ensurePdfExt(name){ name=(name||'output.pdf').trim(); if(!name.toLowerCase().endsWith('.pdf')) name+='.pdf'; return name; }

  // Sortable list helpers
  function makeSortable(listEl){
    let dragEl=null;
    listEl.addEventListener('dragstart',e=>{ const t=e.target.closest('.item'); if(!t) return; dragEl=t; t.classList.add('dragging'); e.dataTransfer.effectAllowed='move'; });
    listEl.addEventListener('dragend',()=>{ if(dragEl){ dragEl.classList.remove('dragging'); dragEl=null; } });
    listEl.addEventListener('dragover',e=>{ e.preventDefault(); const after=getAfter(listEl,e.clientY); const dr=listEl.querySelector('.item.dragging'); if(!dr) return; if(!after) listEl.appendChild(dr); else listEl.insertBefore(dr,after); });
    function getAfter(container,y){
      const els=[...container.querySelectorAll('.item:not(.dragging)')];
      return els.reduce((closest,child)=>{ const box=child.getBoundingClientRect(); const off=y-box.top-box.height/2; if(off<0 && off>closest.offset){ return {offset:off,element:child}; } return closest; },{offset:-Infinity}).element;
    }
  }

  function makeItem(file){
    const div=document.createElement('div');
    div.className='item';
    div.draggable=true;
    div.fileRef=file;
    const kind = (/pdf$/i.test(file.type))? 'PDF' : 'IMG';
    div.innerHTML = `
      <span class="badge">${kind}</span>
      <span class="name">${file.name}</span>
      <span class="size">${(file.size/1024).toFixed(1)} KB</span>`;
    return div;
  }

  const mixInput=$('#mix-input');
  const mixList=$('#mix-list');
  makeSortable(mixList);

  mixInput.addEventListener('change',()=>{
    [...mixInput.files].forEach(f=>{
      if(!(/^application\/pdf$/i.test(f.type) || /^image\/(png|jpe?g)$/i.test(f.type))) return;
      mixList.appendChild(makeItem(f));
    });
    mixInput.value='';
  });

  // select on click
  mixList.addEventListener('click', (e)=>{ const it=e.target.closest('.item'); if(!it) return; $$('#mix-list .item').forEach(n=>n.classList.remove('sel')); it.classList.add('sel'); });
  $('#mix-up').addEventListener('click',()=>moveSelected(mixList,-1));
  $('#mix-down').addEventListener('click',()=>moveSelected(mixList,1));
  $('#mix-remove').addEventListener('click',()=>{ const s=currentSelected(mixList); if(s) s.remove(); });
  $('#mix-clear').addEventListener('click',()=>{ mixList.innerHTML=''; });

  function currentSelected(list){ return list.querySelector('.item.sel'); }
  function moveSelected(list, dir){ const s=currentSelected(list); if(!s) return; if(dir<0 && s.previousElementSibling) list.insertBefore(s, s.previousElementSibling); else if(dir>0 && s.nextElementSibling) list.insertBefore(s.nextElementSibling, s); }

  // Build final PDF (mix of PDFs and images)
  $('#btn-build').addEventListener('click',()=>{ buildMixed().catch(err=>{ console.error(err); alert('Səhv: Yekun PDF yaradılmadı.'); }); });

  async function buildMixed(){
    const items=[...mixList.querySelectorAll('.item')];
    if(items.length===0){ alert('Heç bir fayl seçilməyib.'); return; }
    const { PDFDocument } = window.PDFLib || {};
    if(!PDFDocument){ alert('pdf-lib yüklənmədi.'); return; }
    const out=await PDFDocument.create();

    for(const it of items){
      const file=it.fileRef;
      const buf=new Uint8Array(await file.arrayBuffer());
      const A4={w:595.28,h:841.89}; // 72 dpi pt, A4 portrait
      const margin=24; const maxW=A4.w-2*margin; const maxH=A4.h-2*margin;

      if(/pdf$/i.test(file.type)){
        const src=await PDFDocument.load(buf);
        const pageCount=src.getPageCount();
        for(let i=0;i<pageCount;i++){
          const srcPage=src.getPage(i);
          const { width:pw, height:ph } = srcPage.getSize();
          // Embed & draw onto a fixed-size A4 page (fit & center)
          const embedded = await out.embedPage(srcPage);
          const scale=Math.min(maxW/pw, maxH/ph);
          const w=pw*scale, h=ph*scale; const x=(A4.w-w)/2, y=(A4.h-h)/2;
          const page = out.addPage([A4.w,A4.h]);
          page.drawPage(embedded,{ x, y, width:w, height:h });
        }
      } else if(/^image\/(png|jpe?g)$/i.test(file.type)){
        let img;
        if(/^image\/png$/i.test(file.type)) img=await out.embedPng(buf); else img=await out.embedJpg(buf);
        const dims=img.scale(1);
        const scale=Math.min(maxW/dims.width, maxH/dims.height);
        const w=dims.width*scale, h=dims.height*scale; const x=(A4.w-w)/2, y=(A4.h-h)/2;
        const page=out.addPage([A4.w,A4.h]);
        page.drawImage(img,{x,y,width:w,height:h});
      }
    }

    const bytes=await out.save();
    downloadBytes(bytes, $('#mix-output-name').value || 'yekun.pdf');
  }
})();
</script>
</body>
</html>
